# Environment Variables Configuration

This file shows all environment variables needed for Vercel serverless deployment.

## Generate Secrets

Use these commands to generate secure random secrets:

```bash
# For any secret (32 characters):
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

Or in Python:
```python
import secrets
print(secrets.token_hex(32))
```

---

## Environment Variables

### 1. NODE_ENV - Runtime Environment

```
NODE_ENV=production
```

**Values**:
- `production` - Production environment
- `staging` - Staging/preview environment
- `development` - Local development

**Used by**:
- Error handling
- Logging level
- CORS configuration
- Security headers

---

### 2. TURSO_CONNECTION_URL - Database Connection

```
TURSO_CONNECTION_URL=libsql://your-db-abc123xyz.turso.io
```

**How to get**:
1. Go to [console.turso.tech](https://console.turso.tech)
2. Select your database
3. Copy connection URL (format: `libsql://...`)

**Format**:
- Must start with `libsql://`
- Must NOT include `https://`
- Example: `libsql://your-db-abc123xyz.turso.io`

**Used by**:
- Database connection
- Schema creation
- Data operations

---

### 3. TURSO_AUTH_TOKEN - Database Authentication

```
TURSO_AUTH_TOKEN=eyJhbGciOiJFZDI1NTE5IiwidHlwIjoiSldUIn0...
```

**How to get**:
1. Go to [console.turso.tech](https://console.turso.tech)
2. Select your database
3. Click "Tokens"
4. Create new token or copy existing
5. Make sure it has full access

**Format**:
- Long JWT token
- Copy exactly (no spaces)

**Used by**:
- Authenticate with Turso
- Execute queries
- Read/write data

---

### 4. JWT_SECRET - JWT Token Signing

```
JWT_SECRET=your-secret-key-generated-by-crypto-randomBytes
```

**How to generate**:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**Requirements**:
- Minimum 32 characters
- Use only output from crypto (never manually type)
- Keep secret, never share

**Used by**:
- Sign JWT tokens
- Verify JWT tokens
- User authentication

---

### 5. JWT_REFRESH_SECRET - Refresh Token Signing

```
JWT_REFRESH_SECRET=refresh-secret-key-generated-by-crypto-randomBytes
```

**How to generate**:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**Requirements**:
- Different from JWT_SECRET
- Minimum 32 characters
- Keep secret

**Used by**:
- Sign refresh tokens
- Verify refresh tokens
- Token renewal

---

### 6. SESSION_SECRET - Session Signing

```
SESSION_SECRET=session-secret-key-generated-by-crypto-randomBytes
```

**How to generate**:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**Requirements**:
- Different from JWT secrets
- Minimum 32 characters
- Keep secret

**Used by**:
- Sign session cookies
- Verify session integrity
- OAuth flow

---

### 7. ADMIN_SECRET - Admin Token Signing

```
ADMIN_SECRET=admin-secret-key-generated-by-crypto-randomBytes
```

**How to generate**:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**Requirements**:
- Different from other secrets
- Minimum 32 characters
- Keep secret

**Used by**:
- Sign admin tokens
- Admin authentication
- Elevated permissions

---

### 8. CRON_SECRET - Cron Job Authorization

```
CRON_SECRET=cron-secret-key-generated-by-crypto-randomBytes
```

**How to generate**:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**Requirements**:
- Minimum 32 characters
- Keep secret
- Used to verify Vercel cron requests

**Used by**:
- Verify cron job requests
- Prevent unauthorized cron invocation
- Security for scheduled tasks

---

### 9. CORS_ORIGIN - Cross-Origin Configuration

```
CORS_ORIGIN=https://yourdomain.com
```

**Examples**:
- Production: `https://yourdomain.com`
- With subdomain: `https://app.yourdomain.com`
- Multiple origins: `https://yourdomain.com,https://app.yourdomain.com`
- Development: `http://localhost:3000`
- Allow all: `*` (not recommended for production)

**Used by**:
- CORS middleware
- Browser requests from different origin
- Frontend authentication

---

### 10. FRONTEND_URL - Frontend Application URL

```
FRONTEND_URL=https://yourdomain.com
```

**Examples**:
- Production: `https://yourdomain.com`
- Staging: `https://staging.yourdomain.com`
- Development: `http://localhost:3000`

**Used by**:
- OAuth callbacks
- Redirect URLs
- Email templates

---

### 11. LOG_LEVEL - Logging Verbosity

```
LOG_LEVEL=info
```

**Options**:
- `error` - Only errors
- `warn` - Errors and warnings
- `info` - Normal info (default)
- `debug` - Detailed debug output

**Used by**:
- Winston logger
- Vercel logs filtering
- Debugging

---

### 12. REDIS_URL - Redis Connection (Optional)

```
REDIS_URL=redis://default:password@host:6379
```

**When needed**:
- Persistent sessions
- Cache layer
- Rate limit storage

**How to get**:
- Redis Cloud: [redis.com](https://redis.com)
- Upstash: [upstash.com](https://upstash.com)
- Self-hosted Redis

**Used by**:
- Session storage
- Cache operations
- Rate limiting data

---

### 13. BLOB_READ_WRITE_TOKEN - File Storage (Optional)

```
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_abc...
```

**When needed**:
- File uploads
- Media storage
- Image serving

**How to get**:
1. Vercel Dashboard
2. Storage → Blob
3. Copy token or create new

**Used by**:
- @vercel/blob SDK
- File upload operations
- Media management

---

## Environment File Examples

### .env.local (Development)

```bash
NODE_ENV=development
TURSO_CONNECTION_URL=libsql://localhost
TURSO_AUTH_TOKEN=dev-token
JWT_SECRET=dev-secret-key-12345678901234567890
JWT_REFRESH_SECRET=dev-refresh-secret-1234567890123456789
SESSION_SECRET=dev-session-secret-123456789012345678
ADMIN_SECRET=dev-admin-secret-123456789012345678
CRON_SECRET=dev-cron-secret-1234567890123456789
CORS_ORIGIN=http://localhost:3000
FRONTEND_URL=http://localhost:3000
LOG_LEVEL=debug
```

### .env.preview (Staging)

```bash
NODE_ENV=staging
TURSO_CONNECTION_URL=libsql://staging-db.turso.io
TURSO_AUTH_TOKEN=staging-token-xyz...
JWT_SECRET=staging-jwt-secret-randomly-generated
JWT_REFRESH_SECRET=staging-refresh-secret-randomly-generated
SESSION_SECRET=staging-session-secret-randomly-generated
ADMIN_SECRET=staging-admin-secret-randomly-generated
CRON_SECRET=staging-cron-secret-randomly-generated
CORS_ORIGIN=https://staging.yourdomain.com
FRONTEND_URL=https://staging.yourdomain.com
LOG_LEVEL=info
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_staging...
```

### .env.production (Production)

```bash
NODE_ENV=production
TURSO_CONNECTION_URL=libsql://prod-db.turso.io
TURSO_AUTH_TOKEN=prod-token-xyz...
JWT_SECRET=prod-jwt-secret-randomly-generated
JWT_REFRESH_SECRET=prod-refresh-secret-randomly-generated
SESSION_SECRET=prod-session-secret-randomly-generated
ADMIN_SECRET=prod-admin-secret-randomly-generated
CRON_SECRET=prod-cron-secret-randomly-generated
CORS_ORIGIN=https://yourdomain.com
FRONTEND_URL=https://yourdomain.com
LOG_LEVEL=info
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_prod...
REDIS_URL=redis://default:password@redis.yourdomain.com:6379
```

---

## In Vercel Dashboard

### Steps to Add Environment Variables

1. Go to **Project Settings**
2. Click **Environment Variables**
3. Click **Add New**
4. Enter variable name (key)
5. Enter variable value
6. Select environments:
   - ☐ Production
   - ☐ Preview
   - ☐ Development
7. Click **Save**
8. Redeploy project

### Variable Visibility

| Environment | Development | Preview | Production |
|-------------|-------------|---------|------------|
| Dev secrets | ✓ | ✗ | ✗ |
| Staging secrets | ✗ | ✓ | ✗ |
| Prod secrets | ✗ | ✗ | ✓ |

---

## Security Best Practices

### DO ✓

- ✓ Use Vercel's environment variable management
- ✓ Generate secrets using crypto.randomBytes
- ✓ Use different secrets for each environment
- ✓ Rotate secrets regularly
- ✓ Use strong tokens (minimum 32 bytes)
- ✓ Store secrets securely
- ✓ Audit access to secrets

### DON'T ✗

- ✗ Commit secrets to git
- ✗ Share secrets via email or chat
- ✗ Use weak or predictable secrets
- ✗ Log secrets in error messages
- ✗ Use same secret for multiple environments
- ✗ Expose secrets in client-side code
- ✗ Use console.log for debugging secrets

---

## Troubleshooting

### "Variable not found"

```
Error: process.env.TURSO_CONNECTION_URL is undefined
```

**Solutions**:
1. Check spelling (case-sensitive)
2. Verify added to Vercel dashboard
3. Verify environment scope matches
4. Redeploy after adding variables

### "Invalid token"

```
Error: TURSO_AUTH_TOKEN is invalid
```

**Solutions**:
1. Copy token exactly (no extra spaces)
2. Generate new token if expired
3. Verify token has correct permissions
4. Use full token, not truncated version

### "Secret not updated"

**Solutions**:
1. Go to Vercel dashboard
2. Update environment variable
3. Click "Save"
4. Redeploy project (rebuild required)

---

## Migration from Local to Vercel

### Step 1: Create Local .env

```bash
cp .env.example .env.local
# Fill in with local values
```

### Step 2: Test Locally

```bash
npm run dev
# Verify everything works
```

### Step 3: Generate Secrets for Production

```bash
# For each secret:
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### Step 4: Add to Vercel

1. Go to Vercel dashboard
2. Settings → Environment Variables
3. Add each variable
4. Set scope (Production/Preview/Development)
5. Click Save

### Step 5: Redeploy

1. Go to Deployments
2. Click "Redeploy"
3. Verify deployment succeeds
4. Check logs for any errors

---

## Reference: All Variables

```bash
# Required
NODE_ENV=production
TURSO_CONNECTION_URL=libsql://...
TURSO_AUTH_TOKEN=...
JWT_SECRET=...
JWT_REFRESH_SECRET=...
SESSION_SECRET=...
ADMIN_SECRET=...
CRON_SECRET=...
CORS_ORIGIN=...
FRONTEND_URL=...

# Optional
LOG_LEVEL=info
REDIS_URL=redis://...
BLOB_READ_WRITE_TOKEN=...
```

---

**Last Updated**: February 12, 2026  
**Version**: 1.0  
**Status**: Ready for Production
